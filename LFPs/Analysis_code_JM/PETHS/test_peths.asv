% This code assumes spike times and behavior initiation times in ms
pre=3000; 
post=3000; 
binW=50;
pethEntries=[];
for iUnit=1:size(sClust,1) %for each neuron, could be for each channel
    nt=sClust(iUnit,:);
    unitBehavior=[];
        for bt=trial_ts %for each behavior instance
            unitBehavior=[unitBehavior, nt(nt>bt-pre & nt<bt+post)-bt];
        end
    thisH=hist(unitBehavior, -pre:binW:post)./(length(trial_ts)); %control for trial count
    pethEntries=[pethEntries; thisH*(1000/binW)]; %adjust to Hz
end
figure;
imagesc(zscore(pethEntries')');colorbar;


% pre=3000; post=35000; binW=50;
% thisBresponse=[];
% for n1=1:size(nn,1) %for each neuron, could be for each channel
% nt=nn(n1,:);
% thisN=[];
% for bt=st%for each behavior instance
% thisN=[thisN, nt(nt>bt-pre & nt<bt+post)-bt]; %as of now, I donâ€™t care about trialwise effects, so just putting them all togther
% end
% thisH=hist(thisN,-pre:binW:post)./(length(st)); %control for trial count
% thisBresponse=[thisBresponse; thisH*(1000/binW)]; %adjust to Hz
% end
% figure;
% imagesc(zscore(thisBresponse')');colorbar;

% pre (before the behavior of interest), post (after the behavior of interest), and bw (bin width) are all in milliseconds
% sClust (nn) is a matrix of spike times (columns) and units (rows)
% n1 is an iterator
% spike_times(nn) is the activity (spike times) of a given unit
% thisN is a matrix of this unit's behavior-related activity
% bt is an iterator
% trial_ts (st) is a vector of behavior start times
% thisH is a vector that holds a trial-averaged histogram
% thisBresponse is a matrix that holds the trial-averaged histograms for each unit
